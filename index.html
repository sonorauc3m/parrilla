<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Parrilla · Sonora UC3M</title>

<style>
:root{
  --sonora-red:#be1622;
  --dark-bg:#050307;
  --card:rgba(255,255,255,0.05);
  --border:rgba(255,255,255,0.13);
  --text:#fff;
  --soft:#bfbfbf;
}

*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:"Helvetica Now Display","Helvetica Neue",Helvetica,system-ui,sans-serif;
  background:radial-gradient(circle at top,var(--sonora-red) 0%,var(--dark-bg) 65%);
  color:var(--text);
  display:flex;justify-content:center;
}

/* LAYOUT */
.page{
  width:100%;max-width:500px;
  padding:20px 16px 100px;
  text-align:center;
}

/* LOGO */
.logo{
  width:72%;
  margin:0 auto 18px;
}

/* PARRILLA */
.day{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px 16px;
  margin-bottom:12px;
}

.day-title{
  font-size:0.9rem;
  font-weight:700;
  letter-spacing:0.12em;
  margin-bottom:6px;
}

.slot{
  border-top:1px solid rgba(255,255,255,0.07);
  padding:8px 0;
}
.slot:first-of-type{border-top:none;}

.time{
  font-size:0.78rem;
  color:var(--soft);
}
.title{
  font-size:0.9rem;
  font-weight:600;
  margin-top:2px;
}

/* DIFERIDO */
.od-btn{
  display:inline-block;
  margin-top:6px;
  background:#fff;
  color:var(--sonora-red);
  font-size:0.76rem;
  font-weight:700;
  padding:4px 12px;
  border-radius:999px;
}

/* LIVE BTN */
.live{
  position:fixed;
  bottom:16px;right:50%;
  transform:translateX(50%);
  background:#fff;
  color:var(--sonora-red);
  font-size:0.82rem;
  font-weight:800;
  padding:10px 18px;
  border-radius:999px;
}

</style>
</head>
<body>

<div class="page">

  <!-- LOGO -->
  <img src="sonora_2.1_blanco.png" class="logo">

  <div id="list">Cargando parrilla…</div>

  <a href="https://radio.radiobot.org/public/sonora" target="_blank" class="live">Escuchar en directo</a>

</div>

<script>
/* GOOGLE SHEETS */
const SHEET="1g9f3Ue9GtdaTbpxp3DCXncrNPhjnHPk0m9QTXdfSAxM";
const LIVE="Directo",OD="OnDemand";

const URL=s=>`https://docs.google.com/spreadsheets/d/${SHEET}/gviz/tq?tqx=out:json&sheet=${s}`;

async function load(){
  const L=await fetch(URL(LIVE)).then(r=>r.text());
  const O=await fetch(URL(OD)).then(r=>r.text());

  const live=JSON.parse(L.substr(47).slice(0,-2)).table.rows.slice(1).map(r=>r.c.map(c=>c?.v+""));
  const ond=JSON.parse(O.substr(47).slice(0,-2)).table.rows.slice(1).map(r=>r.c.map(c=>c?.v+""));

  const ondMap={};
  ond.forEach(r=>ondMap[r[0]?.toLowerCase()]={spotify:r[2],ivoox:r[3],yt:r[4]});

  const Days={};
  live.forEach(([d,h,p])=>{
    if(!d||!h||!p)return;
    const key=d.toLowerCase().split(" ")[0];
    Days[key] ??={day:d,programs:[]};
    Days[key].programs.push({h,p});
  });

  const box=document.getElementById("list");
  box.innerHTML="";

  Object.keys(Days).sort().forEach(k=>{
    const card=document.createElement("div");
    card.className="day";

    card.innerHTML=`<div class="day-title">${Days[k].day.toUpperCase()}</div>`;

    Days[k].programs.forEach(s=>{
      const div=document.createElement("div");
      div.className="slot";
      div.innerHTML=`<div class="time">${s.h}</div><div class="title">${s.p}</div>`;

      const found=ondMap[s.p.toLowerCase()];
      const url=found?.spotify||found?.ivoox||found?.yt;
      if(url){
        div.innerHTML+=`<a class="od-btn" target="_blank" href="${url}">Diferido</a>`;
      }

      card.appendChild(div);
    });

    box.appendChild(card);
  });
}

load();
</script>
</body>
</html>
